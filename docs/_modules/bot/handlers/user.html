

<!DOCTYPE html>
<html class="writer-html5" lang="ru" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bot.handlers.user &mdash; –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Spotify Bot 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=e35015f7"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/translations.js?v=cd1d70c9"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å" href="../../../genindex.html" />
    <link rel="search" title="–ü–æ–∏—Å–∫" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Spotify Bot
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" aria-label="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏">
              <p class="caption" role="heading"><span class="caption-text">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../handlers.html">Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bot.html">Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../main.html">Spotify Bot</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Spotify Bot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">–ö–æ–¥ –º–æ–¥—É–ª—è</a></li>
      <li class="breadcrumb-item active">bot.handlers.user</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ bot.handlers.user</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">aiogram</span><span class="w"> </span><span class="kn">import</span> <span class="n">Router</span><span class="p">,</span> <span class="n">F</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aiogram.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span><span class="p">,</span> <span class="n">InlineKeyboardMarkup</span><span class="p">,</span> <span class="n">InlineKeyboardButton</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bot.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">SPOTIFY_CLIENT_ID</span><span class="p">,</span> <span class="n">SPOTIFY_REDIRECT_URI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bot.database.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">()</span>


<div class="viewcode-block" id="start_handler">
<a class="viewcode-back" href="../../../handlers.html#bot.handlers.user.start_handler">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="nd">@router</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;/start&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start_handler</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Spotify.</span>

<span class="sd">    :param message: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">    :type message: Message</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">from_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–æ–∫–µ–Ω–æ–º</span>
    <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">get_or_none</span><span class="p">(</span><span class="n">telegram_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">spotify_access_token</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üëã –ü—Ä–∏–≤–µ—Ç —Å–Ω–æ–≤–∞, </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">from_user</span><span class="o">.</span><span class="n">full_name</span><span class="si">}</span><span class="s2">! –¢—ã —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è Spotify</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;user-library-read &quot;</span>
        <span class="s2">&quot;user-library-modify &quot;</span>
        <span class="s2">&quot;user-read-playback-state &quot;</span>
        <span class="s2">&quot;user-modify-playback-state &quot;</span>
        <span class="s2">&quot;playlist-read-private &quot;</span>
        <span class="s2">&quot;playlist-read-collaborative&quot;</span>
    <span class="p">)</span>

    <span class="c1"># –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</span>
    <span class="n">auth_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://accounts.spotify.com/authorize?&quot;</span>
            <span class="o">+</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="n">SPOTIFY_CLIENT_ID</span><span class="p">,</span>
        <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span>
        <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="n">SPOTIFY_REDIRECT_URI</span><span class="p">,</span>
        <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="n">scope</span><span class="p">,</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="p">)</span>

    <span class="c1"># –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Spotify</span>
    <span class="n">kb</span> <span class="o">=</span> <span class="n">InlineKeyboardMarkup</span><span class="p">(</span><span class="n">inline_keyboard</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">InlineKeyboardButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;üîê –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Spotify&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">auth_url</span><span class="p">)]</span>
    <span class="p">])</span>

    <span class="c1"># –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–æ–π</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span>
        <span class="s2">&quot;–ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞, –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Spotify:&quot;</span><span class="p">,</span>
        <span class="n">reply_markup</span><span class="o">=</span><span class="n">kb</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="help_handler">
<a class="viewcode-back" href="../../../handlers.html#bot.handlers.user.help_handler">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="nd">@router</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;/help&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">help_handler</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /help ‚Äî –≤—ã–≤–æ–¥ —Å–ø—Ä–∞–≤–∫–∏ –ø–æ –±–æ—Ç—É.</span>

<span class="sd">    :param message: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">    :type message: Message</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># –¢–µ–∫—Å—Ç —Å–ø—Ä–∞–≤–∫–∏</span>
    <span class="n">help_text</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;ü§ñ *Spotify Bot* ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—É–∑—ã–∫–æ–π –ø—Ä—è–º–æ –∏–∑ Telegram.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ /start ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Spotify</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ /search &lt;–Ω–∞–∑–≤–∞–Ω–∏–µ&gt; ‚Äî –ø–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ /help ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;üí° –ü–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞ —Ç—Ä–µ–∫–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;   ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;   ‚ù§Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;   ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å&quot;</span>
    <span class="p">)</span>

    <span class="c1"># –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="n">help_text</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ 2026, kotohlebushek. </p>
  </div>

  –°–æ–±—Ä–∞–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ <a href="https://www.sphinx-doc.org/">Sphinx</a> —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">—Ç–µ–º—ã,</a>
    –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>